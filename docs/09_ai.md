# ?? Documentación IA - Ivan Reseller

**Versión:** 1.0.0  
**Última actualización:** 2025-01-23

---

## ?? Índice

1. [Modelos Utilizados](#modelos-utilizados)
2. [Prompts y Plantillas](#prompts-y-plantillas)
3. [Pipeline de IA](#pipeline-de-ia)
4. [Validación](#validación)
5. [Caching](#caching)
6. [Control de Costos](#control-de-costos)

---

## ?? Modelos Utilizados

### GROQ AI

**Proveedor:** GROQ  
**Endpoint:** `https://api.groq.com/openai/v1/chat/completions`  
**Modelos usados:**
- `llama-3.3-70b-versatile` - Sugerencias y análisis (default)
- `llama-3.1-8b-instant` - Optimización de descripciones

**Velocidad:** ~400 tokens/segundo  
**Costo:** Gratis hasta 14,400 requests/día  
**Evidencia:** `backend/src/services/ai-suggestions.service.ts:1093`

---

## ?? Prompts y Plantillas

### 1. Prompt de Sugerencias IA

**Ubicación:** `backend/src/services/ai-suggestions.service.ts:1231-1390`

**Propósito:** Generar sugerencias específicas de dropshipping automatizado

**System Prompt:**
```
Eres un consultor experto en DROPSHIPPING automatizado. 
Especializado en optimización de flujos AliExpress ? Marketplaces 
(eBay, Amazon, MercadoLibre). Genera sugerencias ESPECÍFICAS de 
dropshipping automatizado, NO genéricas de e-commerce.
```

**User Prompt Template:**
```
Eres un consultor experto en DROPSHIPPING automatizado. 
Analiza los siguientes datos de un negocio de dropshipping...

CONTEXTO DEL SISTEMA:
- Sistema automatizado de dropshipping
- Fuente: AliExpress (scraping automatizado)
- Canales: eBay, Amazon, MercadoLibre

DATOS DEL NEGOCIO:
- Ventas totales: {totalSales}
- Ingresos totales: ${totalRevenue}
- Ganancia total: ${totalProfit}
- Productos activos: {activeProducts}
- Margen promedio: {averageProfitMargin}%
- Mejor categoría: {bestCategory}
- Peor categoría: {worstCategory}

SE?ALES RECIENTES:
[Segmentos, productos, demanda, operaciones exitosas]

GENERA SUGERENCIAS ESPECÍFICAS DE DROPSHIPPING...
```

**Output esperado:** JSON con array de sugerencias

**Evidencia:** `backend/src/services/ai-suggestions.service.ts:1284-1389`

---

### 2. Prompt de Análisis Estratégico (CEO Agent)

**Ubicación:** `backend/src/services/ceo-agent.service.ts:362-382`

**Propósito:** Análisis estratégico de negocio

**Prompt:**
```
You are a strategic business consultant analyzing an e-commerce 
dropshipping business.

Performance Data:
- Total Products Analyzed: {totalProductsAnalyzed}
- Successful Sales: {successfulSales}
- Prediction Accuracy: {accuracyRatePct}%
- Average Profit: ${averageProfit}
- Average ROI: {averageROI}%
- Best Category: {bestCategory}
- Worst Category: {worstCategory}

Provide strategic insights in JSON format:
{
  "marketTrends": [...],
  "opportunityAreas": [...],
  "riskFactors": [...],
  "recommendations": [...],
  "confidenceScore": 0.85
}
```

**Evidencia:** `backend/src/services/ceo-agent.service.ts:362-382`

---

### 3. Prompt de Optimización de Descripciones

**Ubicación:** `backend/src/services/marketplace.service.ts:1282-1297`

**Propósito:** Generar descripciones optimizadas para marketplaces

**System Prompt:**
```
You are a professional e-commerce copywriter. Create compelling, 
SEO-friendly product descriptions for {marketplace} marketplace. 
Descriptions should highlight key features, benefits, and be 
optimized for conversions. Keep it between 200-500 words.
```

**User Prompt (con descripción):**
```
Create an optimized product description for {marketplace}:
Title: {product.title}
Original description: {currentDescription}
Category: {product.category}

Return only the optimized description, no explanations.
```

**User Prompt (sin descripción):**
```
Create a comprehensive and compelling product description for 
{marketplace} based only on the product title:
Title: {product.title}
Category: {product.category}

Generate a detailed product description (200-400 words) that 
highlights key features, benefits, and specifications.
```

**Evidencia:** `backend/src/services/marketplace.service.ts:1282-1297`

---

## ?? Pipeline de IA

### Flujo de Sugerencias IA

```
1. Usuario solicita sugerencias
   ?
2. AISuggestionsService.generateSuggestions()
   ?
3. Recopilar datos del negocio (UserBusinessData)
   ?
4. Detectar se?ales (DataDrivenSignals)
   ?
5. Construir prompt (buildPrompt())
   ?
6. Llamar a GROQ API
   ?
7. Parsear respuesta JSON
   ?
8. Validar y filtrar sugerencias
   ?
9. Guardar en BD (AISuggestion)
   ?
10. Retornar al usuario
```

**Evidencia:** `backend/src/services/ai-suggestions.service.ts:1006-1226`

---

### Flujo de Optimización de Descripciones

```
1. Publicar producto en marketplace
   ?
2. MarketplaceService.optimizeDescription()
   ?
3. Verificar si hay descripción válida
   ?
4. Construir prompt según caso
   ?
5. Llamar a GROQ API (llama-3.1-8b-instant)
   ?
6. Validar respuesta
   ?
7. Usar descripción optimizada o fallback
```

**Evidencia:** `backend/src/services/marketplace.service.ts:1280-1322`

---

## ? Validación

### Validación de Respuestas IA

**Validaciones implementadas:**
1. **Estructura JSON** - Verificar que respuesta es JSON válido
2. **Campos requeridos** - Verificar que tiene campos necesarios
3. **Tipos de datos** - Validar tipos correctos
4. **Rangos** - Validar confidence (0-100), etc.

**Fallback:**
- Si falla validación ? Usar sugerencias basadas en datos
- Si falla todo ? Retornar array vacío (nunca crashear)

**Evidencia:** `backend/src/services/ai-suggestions.service.ts:1163-1226`

---

## ?? Caching

### Caching de Sugerencias

**Implementación:**
- Sugerencias se guardan en BD (`AISuggestion`)
- Cache por usuario
- Expiración: Sugerencias se regeneran periódicamente

**Evidencia:** `backend/src/services/ai-suggestions.service.ts:1196-1204`

---

## ?? Control de Costos

### Límites y Control

**Límites implementados:**
- Timeout: 30 segundos por request
- Max tokens: 2000 (sugerencias), 1000 (descripciones)
- Fallback: Si falla API, usar datos sin IA

**Monitoreo:**
- Logging de cada llamada a API
- Tracking de errores
- Métricas de uso

**Evidencia:** `backend/src/services/ai-suggestions.service.ts:1101-1126`

---

**Próximos pasos:** Ver [API Reference](./10_api_reference.md) para endpoints completos.
