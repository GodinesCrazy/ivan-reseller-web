# DROPSHIPPING OAUTH INFRASTRUCTURE FIX REPORT

FRONTEND DOMAIN: `https://www.ivanreseller.com` (detected from current frontend return defaults and docs).

BACKEND DOMAIN: Backend-only callback source is now `BACKEND_URL` (preferred) or `RAILWAY_STATIC_URL`/public `API_URL` fallback. Current Railway project context: `ivan-reseller / production / ivan-reseller-backend`.

REDIRECT URI BEFORE: `WEB_BASE_URL + /api/marketplace-oauth/callback` (could resolve to frontend domain and cause infrastructure mismatch).

REDIRECT URI AFTER: `https://<BACKEND_DOMAIN>/api/marketplace-oauth/callback` only, generated by `getAliExpressDropshippingRedirectUri()` from backend env (`BACKEND_URL`/`RAILWAY_STATIC_URL`/public `API_URL`). `ALIEXPRESS_DROPSHIPPING_REDIRECT_URI` is ignored if it does not match canonical backend callback.

TOKEN EXCHANGE EXECUTED IN: Backend only (`backend/src/services/aliexpress-dropshipping-api.service.ts` via `marketplace-oauth.routes.ts` callback handlers).

TOKENS STORED: Not yet in this run. `verify-aliexpress-isolation.ts` shows no current dropshipping token hashes for user 1 in `api_credentials` (fresh real OAuth code still required).

FRONTEND STATE STATUS: Frontend does not process OAuth `code` directly; it only handles `oauth=success|error` return state and postMessage, with stale-lock cleanup for OAuth button state.

OAUTH FINAL STATUS: Infrastructure mismatch fixed at code level (backend-only callback canonical). End-to-end token persistence pending a live OAuth authorization code exchange in production.

PRODUCTION READY: **Partially**. Code is production-ready and build-valid; final operational check requires:
- Railway env login/verification to ensure `BACKEND_URL` (or `RAILWAY_STATIC_URL`) is correctly set.
- One real OAuth cycle to confirm callback arrival, exchange success, and token persistence in `api_credentials`.
